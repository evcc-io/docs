---
sidebar_position: 10
---

# § 14a EnWG & SteuVE

:::info Current Development
The implementation of § 14a EnWG is still being rolled out.
Control boxes and Smart Meter Gateways are currently being deployed.
:::

evcc supports external control of charging points by grid operators in accordance with § 14a EnWG.
This enables reduced grid fees whilst ensuring grid stability.

## Background

§ 14a of the German Energy Industry Act (EnWG) regulates grid-friendly control of controllable consumption devices (SteuVE).
Grid operators can temporarily reduce the power of large consumers such as wallboxes, heat pumps or battery storage systems in the event of grid overload.
In return, customers receive reduced grid fees.

Important points:

- Affects consumers from 4.2 kW power
- Control via Smart Meter Gateway and control box
- Customers benefit from reduced grid fees

evcc supports two connection methods: **Relay** (analogue via a switch contact) or **EEBus** (digital via the EEBus protocol).

## Setting Up Load Management

Load management must be configured for § 14a EnWG control.
A special `lpc` (Local Power Control) circuit is created, to which all controllable consumers are assigned.
When a reduction signal is active, evcc automatically sets a temporary power limit for this circuit.

### Minimal Configuration

```yaml
circuits:
  - name: lpc # Local Power Control - circuit for grid requirements

loadpoints:
  - title: Garage
    charger: charger1
    circuit: lpc # controllable consumer
  - title: Carport
    charger: charger2
    circuit: lpc # controllable consumer
```

All charging points assigned to the `lpc` circuit or a sub-circuit are reduced accordingly when a control request is received.

For advanced configurations with sub-circuits, see [Load Management](./loadmanagement).

:::info Highest Level
The `lpc` circuit always has the highest level.
If you don't define it manually (as above), it will be automatically created when HEMS is configured and inserted above the highest circuit.
:::

:::tip Configuration Interface
Load management and HEMS can also be set up via the configuration interface.
Important: Configure load management first before setting up HEMS.
:::

## Configuration via Relay (Analogue)

The analogue connection via a switch contact is the simplest solution.
The control box activates a contact which is evaluated by evcc.

### Basic Configuration

```yaml
hems:
  type: relay
  maxPower: 8400 # Total power limit when signal is active (in watts)
  limit:
    # Plugin-specific configuration
```

### Determining the Power Limit

The power limit is communicated to you by the grid operator.
For multiple controllable consumption devices (SteuVE), the simultaneity factor is taken into account.
You can also calculate the limit yourself using the formula: **Total limit = Number of SteuVE × 4.2 kW × Simultaneity factor**. Details on the calculation can be found [here](https://www.inexogy.com/blog/14a-enwg/).

### Examples for Different Connections

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs>
<TabItem value="gpio" label="Raspberry Pi GPIO">

When using a Raspberry Pi, the GPIO pin can be read directly:

```yaml
hems:
  type: relay
  maxPower: 8400 # Example for 2 SteuVE
  limit:
    source: script
    cmd: gpioget gpiochip0 17 # Read GPIO pin 17
    # Return value: 0 = not limited, 1 = limited
```

</TabItem>
<TabItem value="mqtt" label="MQTT">

If the control box or gateway sends MQTT messages:

```yaml
hems:
  type: relay
  maxPower: 11340 # Example for 3 SteuVE with simultaneity factor 0.9
  limit:
    source: mqtt
    topic: hems/limit/status
    # Expected values: 0/false = normal, 1/true = limited
```

</TabItem>
<TabItem value="http" label="HTTP API">

For control boxes with REST API:

```yaml
hems:
  type: relay
  maxPower: 13440 # Example for 4 SteuVE with simultaneity factor 0.8
  limit:
    source: http
    uri: http://steuerbox.local/api/limit
    jq: .limited # JSON path to boolean value
```

</TabItem>
</Tabs>

## Configuration via EEBus (Digital)

The digital connection via EEBus is the future-proof and preferred solution.
The control box communicates directly with evcc via the EEBus protocol and automatically transmits the power limit.

### Prerequisites

- evcc installation with EEBus support
- Control box with EEBus interface
- Network connection between evcc and control box

### Step 1: Generate Certificates

EEBus requires certificates for secure communication. These must be created once.
Run the following command in the console:

```bash
evcc eebus-cert
```

This command creates the required certificates and displays the configuration that must be inserted into `evcc.yaml`.

### Step 2: Basic EEBus Configuration

Add the EEBus configuration to `evcc.yaml`:

```yaml
# Basic EEBus configuration
eebus:
  certificate:
    public: |
      -----BEGIN CERTIFICATE-----
      # Insert public key here
      -----END CERTIFICATE-----
    private: |
      -----BEGIN EC PRIVATE KEY-----
      # Insert private key here
      -----END EC PRIVATE KEY-----
  # Optional: Specify network interface (recommended)
  interfaces:
    - eth0 # or the appropriate interface
  # Optional: Define your own SKI
  shipid: EVCC-1234567890abcdef
```

### Step 3: HEMS Configuration

Configure the HEMS interface for § 14a EnWG:

```yaml
hems:
  type: eebus
  ski: "1234-5678-90AB-CDEF" # SKI of the control box
  # You can find the SKI in your control box documentation
```

:::note Note
With EEBus, the power limit is automatically transmitted by the control box.
:::

### Step 4: Determine SKI and Pairing

#### Determine evcc SKI

After starting evcc, your own SKI is displayed in the logs:

```bash
evcc --log debug | grep -i ski
```

#### Perform Pairing

1. **In the control box**: Add evcc as HEMS
   - Enter the SKI of evcc
   - Specify the IP address of evcc
   - Start the pairing process

2. **In evcc**: Add the control box SKI to the HEMS configuration
   - Enter the control box SKI in the HEMS configuration
   - Restart evcc

3. **Check connection**:
   ```bash
   # Activate trace logging for EEBus
   evcc -l trace eebus
   ```

:::tip Important

- Certificates only need to be generated once
- After successful pairing, the configuration must not be changed
  :::

## How It Works

### Normal Operation

In normal operation, evcc charges without power limitation by the HEMS.
The charging points operate with their normal configuration and are coordinated by additional [Load Management](./loadmanagement) restrictions if applicable.

### Reduction Signal Active

When the grid operator sends a reduction signal:

1. **Relay**: The contact is closed, evcc activates the configured `maxPower` limit
2. **EEBus**: The control box digitally transmits the calculated total limit

evcc reduces all charging points assigned to the `lpc` circuit according to the limit.
If total consumption is too high, charging processes can also be stopped.
The control affects all modes (Solar, Min+Solar, Fast).

**Battery control during reduction:**
If [active battery control](./battery#battery-control) is configured and grid charging of the home battery is active, this is automatically paused.
The battery is set to "hold" mode so that it neither charges nor discharges.
After the power reduction ends, grid charging automatically resumes.

When a control limit is active, a **banner with control notice** is displayed on the main page in evcc.

## Controlling Additional Consumers

In addition to charging points, other controllable consumers can also be integrated into § 14a load management.
This applies e.g. to heat pumps or battery storage systems that are configured as meters with a switching output.

### Prerequisites

- The consumer must be configured as a meter with switching output (`switch`) in evcc
- HEMS configuration (relay or EEBus) must be set up
- The meter must be assigned to the `lpc` circuit

### Configuration Example

```yaml
meters:
  - name: heatpump
    type: template
    template: eebus-mcp
    usage: charge
    # Additional meter configuration ...

circuits:
  - name: lpc
    meter: heatpump # Assign meter

hems:
  type: eebus # or relay
  # Additional HEMS configuration ...
```

### How It Works

When a reduction signal is active, evcc automatically controls:

1. **Charging points**: Power is throttled according to the limit
2. **Switchable meters**: Are switched on and off as needed to maintain the total limit

The control takes into account the current power consumption of all consumers assigned to the `lpc` circuit.
If throttling the charging points is not sufficient, additional consumers are switched off.

:::note EEBus Consumer
This feature is currently only available for EEBus consumers.
For some devices, power can also be continuously dimmed.
This enables more precise control than simple on/off switching.
Support for additional meters will be added in the future.
:::

## Further Information

- [Load Management](./loadmanagement) - Basics of load distribution
- [Plugins](../devices/plugins) - Advanced plugin configurations
